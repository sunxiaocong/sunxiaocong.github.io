---
layout: post
title: "日志采集与同步"
date: 2019-03-05
categories: 大数据笔记
tags: [数据采集]
image: http://gastonsanchez.com/https://github.com/daijiangtian/NoteBook/blob/master/机器学习/时间序列/https://github.com/daijiangtian/NoteBook/blob/master/机器学习/时间序列/https://github.com/daijiangtian/NoteBook/blob/master/机器学习/时间序列/images/blog/mathjax_logo.png?raw=true?raw=true?raw=true
---

日志采集至数据仓库主要有两个方面的数据：
1、从客户端获取的数据，又分为浏览器和APP端
2、从个业务数据库同步至数据仓库的数据

<!-- more -->

## 日志采集

### 浏览器页面采集

#### 浏览页面展示日志
当一个页面被浏览器加载呈现时采集的日志。用于计算页面浏览量(PV) 和 访客数(UV)

(1) 日志采集。一般在页面html文档内的JavaScript脚本来执行，脚本被浏览器加载解析后执行。可以保证页面已经被完全加载呈现出来
(2) 日志发送。采集脚本执行时会向日志服务器发送请求。一般是立即发送，也可能延迟发送。
(3) 服务端收集。返回一个请求成功响应，以免对页面正常加载影响。
(4) 日志解析存档。

#### 页面交互日志

采集用户在网页上的行为数据，以便通过量获知用户感兴趣点 获知 体验优化点

在页面的内容与交互方式不可预估导致无法规定统一的采集内容。
(1) 构建一个通用性的服务满足自定义注册内容
(2) 服务端收集日志后保存在中间件中，对日志内容不做处理
(3) 下游业务按需自行解析

### 页面日志清洗与预处理
(1) 识别流量攻击。对日志合法性进行校验
(2) 数据缺项补正。如公用且重要的数据取值归一，标准化或反向补正。反向补正即根据新的日志对稍早手机的日志做回补
(3) 无效数据剔除
(4) 日志隔离分发

### 客户端(移动端)日志采集
客户端不同于浏览器，可以在自己的应用里面嵌入代码对整个采集的效率做优化。更多时候是对给各类客户端定义
统一接口编写SDK进行数据采集。并且当数据量较大时可以采用延迟发送机制。在客户端内积累了一批日志后在统一
发送给服务器。

## 数据同步
数据同步技术更通用的含义是不同系统间的数据流转,有多种不
同的应用场景。主数据库与备份数据库之间的数据备份,以及主系统与
子系统之间的数据更新,属于同类型不同集群数据库之间的数据同步。
另外,还有不同地域、不同数据库类型之间的数据传输交换,比如分布
式业务系统与数据仓库系统之间的数据同步。对于大数据系统来说,包
含数据从业务系统同步进入数据仓库和数据从数据仓库同步进入数据
服务或数据应用两个方面。

源业务数据的类型有很多。需要对不同的数据类型不同的场景使用不同的同步方式：
同步方式可以分为三种。直连同步，数据文件同步，数据库日志解析同步

### 直连同步

通过定义和规范的接口API 基于动态链接库的方式直接链接业务库。
- 优点
  - 配置方便，容易实现
- 缺点
  - 对业务库直连对数据库的性能影响较大

不适用与数据量较大的场景

### 数据文件同步

数据文件同步通过约定好的文件编码、大小、格式等,直接从源系
统生成数据的文本文件,由专门的文件服务器,如 FTP 服务器传输到
目标系统后,加载到目标数据库系统中。当数据源包含多个异构的数据
库系统(如 MySQL、Oracle、SQL Server、DB2 等)时,用这种方式比
较简单、实用。
为了确保数据文件同步的完整性,通常除了上传数据文件本身以外,还会上传一
个校验文件,该校验文件记录了数据文件的数据量以及文件大小等校验
信息,以供下游目标系统验证数据同步的准确性。
在过程中还可以配置加压加密功能，提高传输效率与安全性。

### 数据库日志解析同步
通过数据库的归档日志 WAL日志 BINLOG日志 的解析获取源业务库数据的变化
该方式实时性高，对数据库没有影响，在较多的时候时候此方法进行数据同步。